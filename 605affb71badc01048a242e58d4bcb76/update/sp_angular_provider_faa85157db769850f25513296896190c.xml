<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_angular_provider">
    <sp_angular_provider action="INSERT_OR_UPDATE">
        <name>ratelockLiveProfiles</name>
        <script><![CDATA[function ratelockLiveProfiles($window, $http) {
  var liveProfiles = {};
  liveProfiles.defaultProfile = {
    userID: null,
    name: 'Guest',
    initials: 'GS'
  };

  liveProfiles[$window.NOW.user_id] = {
    userID: $window.NOW.user_id,
    name: $window.NOW.user_display_name,
    initials: $window.NOW.user_initials
  };

  if ($window.NOW.user_avatar) {
    liveProfiles[$window.NOW.user_id].userImage = $window.NOW.user_avatar;
  }

  function getLiveProfileById(sysId) {
    return liveProfiles[sysId];
  }

  function buildInitials(name) {
    if (!name)
      return "--";

    var initials = name.split(" ").map(function (word) {
      return word.toUpperCase();
    }).filter(function (word) {
      return word.match(/^[A-Z]/);
    }).map(function (word) {
      return word.substring(0, 1);
    }).join("");

    return (initials.length > 3) ? initials.substr(0, 3) : initials;
  }
  var pending = {};

  function hasLiveProfile(userId) {
    if (!userId)
      return false;

    if (liveProfiles[userId])
      return true;
    
    if (userId === 'system') {
      liveProfiles[userId] = {
        userID: userId,
        name: userId,
        initials: userId.charAt(0).toUpperCase()
      };
      return true;
    }

    if (pending[userId])
      return false;

    pending[userId] = $http.get('/api/now/live/profiles/sys_user.' + userId).then(function (response) {
      liveProfiles[userId] = {
        userID: response.data.result.sys_id,
        name: response.data.result.name.toString(),
        initials: response.data.result.initials
      };
    });

    return false;
  }
  return {
    getLiveProfileById: getLiveProfileById,
    hasLiveProfile: hasLiveProfile
  };
}]]></script>
        <sys_class_name>sp_angular_provider</sys_class_name>
        <sys_created_by>douglas.schamberg@movement.com</sys_created_by>
        <sys_created_on>2020-08-28 08:50:15</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>faa85157db769850f25513296896190c</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>ratelockLiveProfiles</sys_name>
        <sys_package display_value="Ratelock" source="x_momo_ratelock">605affb71badc01048a242e58d4bcb76</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Ratelock">605affb71badc01048a242e58d4bcb76</sys_scope>
        <sys_update_name>sp_angular_provider_faa85157db769850f25513296896190c</sys_update_name>
        <sys_updated_by>douglas.schamberg@movement.com</sys_updated_by>
        <sys_updated_on>2020-08-28 08:58:13</sys_updated_on>
        <type>factory</type>
    </sp_angular_provider>
</record_update>
