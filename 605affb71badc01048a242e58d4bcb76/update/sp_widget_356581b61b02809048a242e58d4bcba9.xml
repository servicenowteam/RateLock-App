<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, $rootScope, $window, $interval, $timeout, mmSessions) {
  /* widget controller */
  var c = this;

  c.$onInit = function () {
		mmSessions.setChannel($scope.data.table, $scope.data.sys_id);
  };

  $window.addEventListener('beforeunload', function () {
    $timeout.cancel();
  });
	
	c.$onDestroy = function() {
		delete $scope.session;
		$timeout.cancel();
	};

  $scope.getColor = function (status) {
    var cls = "transparent";
    switch (status) {
      case 'exiting':
        color = 'yellow';
        break;
      case 'viewing':
        color = 'green';
        break;
      case 'typing':
        color = 'red';
        break;
      default:
        color = 'transparent';
        break;
    }
    return color;
  };
	
	var EVENT_NAMES = {
		connected: 'sessions.' + $scope.data.sys_id + '.connected',
		message: 'sessions.' + $scope.data.sys_id + '.message',
		pong: 'sessions.' + $scope.data.sys_id + '.pong'
	};
	
	$rootScope.$on(EVENT_NAMES.connected, function(evt) {
		mmSessions.subscribe($scope.data.sys_id);
		mmSessions.ping($scope.data.sys_id);
	});
	
	$rootScope.$on(EVENT_NAMES.message, function(evt, session) {
		if (session.status && session.sessionId != $window.NOW.session_id) {
			$scope.session = session;
		} else if (angular.isDefined($scope.session)) {
			$scope.session = false;
		}
		
		
		if ($scope.session.status == 'exiting') {
			$timeout(function() {
				$scope.session = false;
			}, 3000);
		}
	});
	
	
	$rootScope.$on(EVENT_NAMES.pong, function(evt, session) {
		if (session.status && session.sessionId != $window.NOW.session_id) {
			$scope.session = session;
		} else if (angular.isDefined($scope.session)) {
			$scope.session = false;
		}
		if ($scope.session.status == 'exiting') {
			$timeout(function() {
				$scope.session = false;
			}, 3000);
		}
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.ticker {&#13;
	position: absolute;&#13;
  top: 0;&#13;
  left: 0;&#13;
  width: 0;&#13;
  height: 0;&#13;
  line-height: 0;&#13;
  font-size: 0;&#13;
  z-index: 1000;&#13;
}&#13;
&#13;
.ticker &gt; span {&#13;
  border-bottom: 20px solid transparent;&#13;
  border-right: 20px solid transparent;&#13;
  transition: border-left 0.2s ease-in;&#13;
	&amp;.green {&#13;
    border-left: 20px solid green;&#13;
  }&#13;
  &amp;.red {&#13;
    border-left: 20px solid red;&#13;
  }&#13;
  &amp;.yellow {&#13;
    border-left: 20px solid #fcd80c;&#13;
  }&#13;
  &amp;.transparent {&#13;
  	border-left: 20px solid transparent;&#13;
  }&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>ratelock_list_sessions</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Ratelock List Sessions</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	data.table = options.table || $sp.getParameter("table");
	data.sys_id = options.sys_id || $sp.getParameter("sys_id");
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>douglas.schamberg</sys_created_by>
        <sys_created_on>2020-01-03 15:10:33</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>356581b61b02809048a242e58d4bcba9</sys_id>
        <sys_mod_count>73</sys_mod_count>
        <sys_name>Ratelock List Sessions</sys_name>
        <sys_package display_value="Ratelock" source="x_momo_ratelock">605affb71badc01048a242e58d4bcb76</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Ratelock">605affb71badc01048a242e58d4bcb76</sys_scope>
        <sys_update_name>sp_widget_356581b61b02809048a242e58d4bcba9</sys_update_name>
        <sys_updated_by>douglas.schamberg</sys_updated_by>
        <sys_updated_on>2020-05-25 17:59:34</sys_updated_on>
        <template><![CDATA[<div class="ticker" ng-show="session">
  <span uib-tooltip="{{session.userDisplayName}} is {{session.status}}"
    ng-class="getColor(session.status)" 
    tooltip-placement="top"
    class="hidden-xs"
    ng-show="session.status && session.id === data.sys_id"
    tooltip-append-to-body="true"></span>
  <span uib-tooltip="{{session.userDisplayName}} is {{session.status}}"
    ng-class="getColor(session.status)" 
    tooltip-placement="right"
    class="hidden-md hidden-lg hidden-xl"
    ng-show="session.status && session.id === data.sys_id"
    tooltip-append-to-body="true"></span>
</div>]]></template>
    </sp_widget>
</record_update>
